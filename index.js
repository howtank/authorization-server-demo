const { Provider } = require('oidc-provider');

const LISTENING_PORT = 3000;

const configuration = {
  clients: [{
		application_type: 'web',
		token_endpoint_auth_method: 'none',
		response_types: ['id_token'],
		grant_types: ['implicit'],

    client_id: 'id_provided_by_howtank',
    redirect_uris: ['https://jwt.io'],
    scope: 'openid profile email',
  }, {
		application_type: 'web',
		token_endpoint_auth_method: 'none',
		response_types: ['id_token'],
		grant_types: ['implicit'],

    client_id: 'howtank',
    redirect_uris: ['https://community.papote.co'],
    scope: 'openid profile email',
  }],
  features: {
    claimsParameter: { enabled: true },
    clientCredentials: { enabled: true },
    introspection: { enabled: true },
    devInteractions: { enabled: true },
  },
  claims: {
    email: ['email'],
    profile: ['pseudo', 'first_name', 'last_name', 'birthdate', 'picture']
  },
  routes: {
    // jwks: '/.well-known/jwks.json',
  },
  async findAccount(ctx, id) {
    return {
      accountId: id,
      async claims(use, scope) {
        return {
          sub: id,
          email: id,
          pseudo: id,
          first_name: "foo",
          last_name: "bar",
          birthdate: "1970-01-01",
          picture: "data:image/jpeg;base64,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",
        }
      }
    }
  }
};

const oidc = new Provider(`http://localhost:${LISTENING_PORT}`, configuration);

oidc.listen(LISTENING_PORT, () => {
  console.log(`oidc-provider listening on port ${LISTENING_PORT}, check http://localhost:${LISTENING_PORT}/.well-known/openid-configuration`);
});
